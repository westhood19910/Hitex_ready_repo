<!-- CODE FOR CLIENT DASHBOARD PAGE -->

<div id="discountBanner" class="discount-banner hidden">
        <button class="banner-dismiss" onclick="dismissDiscountBanner()">&times;</button>
        <div class="banner-content">
            <div class="banner-header">
                <span class="banner-icon">ðŸŽ“</span>
                <h3 class="banner-title">Institutional Discount Available!</h3>
            </div>
            <p class="banner-description">
                We noticed you're affiliated with <span id="institutionName">your institution</span>. 
                You're eligible for a <span id="discountPercentage">0</span>% discount on all our editing services!
            </p>
            <div class="banner-actions">
                <button class="banner-btn primary" onclick="claimDiscount()">Claim Your Discount</button>
                <button class="banner-btn" onclick="dismissDiscountBanner()">Maybe Later</button>
            </div>
        </div>
    </div>

    <!-- Discount Code Display Component -->
    <div id="discountCodeContainer" class="discount-code-container hidden">
        <div class="discount-code-header">
            <div class="discount-code-icon">ðŸŽ«</div>
            <div>
                <h4 style="margin: 0;">Your Institutional Discount Code</h4>
                <p style="margin: 0.5rem 0 0 0; color: #666;">Save <span id="savedPercentage">0</span>% on your next order</p>
            </div>
        </div>
        <div class="discount-code-display">
            <div class="discount-code-value" id="discountCodeValue">LOADING...</div>
            <div class="discount-code-actions">
                <button class="copy-btn" onclick="copyDiscountCode()">Copy Code</button>
                <button class="apply-btn" onclick="applyDiscountToPayment()">Apply to Order</button>
            </div>
        </div>
        <p style="font-size: 0.9rem; color: #666; margin: 1rem 0 0 0; text-align: center;">
            Code expires in <span id="codeExpiry">90 days</span>
        </p>
    </div>

    <!-- Payment Integration Component -->
    <div id="paymentDiscountSection" class="payment-discount-section hidden">
        <h4>Apply Institutional Discount</h4>
        <div class="discount-input-group">
            <input 
                type="text" 
                id="discountCodeInput" 
                class="discount-input" 
                placeholder="Enter discount code"
                maxlength="20"
            >
            <button class="apply-discount-btn" onclick="validateDiscountCode()">Apply</button>
        </div>
        <div id="discountSummary" class="discount-summary hidden">
            <div class="discount-line">
                <span>Subtotal:</span>
                <span id="subtotalAmount">$0.00</span>
            </div>
            <div class="discount-line">
                <span>Institutional Discount (<span id="appliedDiscountPercent">0</span>%):</span>
                <span id="discountAmount" style="color: #4caf50;">-$0.00</span>
            </div>
            <div class="discount-line total">
                <span>Total:</span>
                <span id="finalAmount">$0.00</span>
            </div>
        </div>
    </div>

    <!-- Admin Panel Components -->
    <div id="adminPanel" class="hidden">
        <!-- Partner Institutions Management -->
        <div class="admin-section">
            <div class="admin-header">
                <h3>Partner Institutions</h3>
                <button class="admin-btn" onclick="openAddInstitutionModal()">Add Institution</button>
            </div>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Institution Name</th>
                        <th>Email Domains</th>
                        <th>Discount %</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="institutionsTableBody">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Discount Analytics -->
        <div class="admin-section">
            <div class="admin-header">
                <h3>Discount Usage Analytics</h3>
                <button class="admin-btn" onclick="refreshAnalytics()">Refresh</button>
            </div>
            <div class="metrics-matrix" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <div class="metric-capsule" style="background: #f8f9ff; padding: 1.5rem; border-radius: 8px; text-align: center;">
                    <h4>Total Codes Generated</h4>
                    <div class="figure" id="totalCodes" style="font-size: 2rem; font-weight: bold; color: #667eea;">0</div>
                </div>
                <div class="metric-capsule" style="background: #f8f9ff; padding: 1.5rem; border-radius: 8px; text-align: center;">
                    <h4>Codes Used</h4>
                    <div class="figure" id="usedCodes" style="font-size: 2rem; font-weight: bold; color: #4caf50;">0</div>
                </div>
                <div class="metric-capsule" style="background: #f8f9ff; padding: 1.5rem; border-radius: 8px; text-align: center;">
                    <h4>Conversion Rate</h4>
                    <div class="figure" id="conversionRate" style="font-size: 2rem; font-weight: bold; color: #ff9800;">0%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Institution Modal -->
    <div id="addInstitutionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Partner Institution</h3>
                <button class="modal-close" onclick="closeAddInstitutionModal()">&times;</button>
            </div>
            <form id="addInstitutionForm">
                <div class="form-group">
                    <label class="form-label">Institution Name *</label>
                    <input type="text" class="form-input" id="institutionNameInput" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Institution Code</label>
                    <input type="text" class="form-input" id="institutionCodeInput" maxlength="10">
                </div>
                <div class="form-group">
                    <label class="form-label">Email Domains * (comma-separated)</label>
                    <input type="text" class="form-input" id="emailDomainsInput" placeholder="university.edu, dept.university.edu" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Discount Percentage *</label>
                    <input type="number" class="form-input" id="discountPercentageInput" min="1" max="50" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Email</label>
                    <input type="email" class="form-input" id="contactEmailInput">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="notesInput" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="admin-btn" style="background: #ccc;" onclick="closeAddInstitutionModal()">Cancel</button>
                    <button type="submit" class="admin-btn">Add Institution</button>
                </div>
            </form>
        </div>
    </div>
    