<!DOCTYPE html>
<html lang="en">
<head> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<script src="Embednav.js" defer></script>
<script src="freshtex.js" defer></script> 
<link rel="stylesheet" href="ser_them.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" defer>
<link rel="stylesheet" href="fresh.css">  
<link rel="stylesheet" href="Embednav.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head> 
<body>
    <!-- <header class="pag-2-hed-1">
                <div class="lat_clo_001">              
                <a href="index.html" class="action-home">
                  <i class="fa-solid fa-house"></i>
               </a>  
                </div>  
                <div class="lat_clo_002">
                <button class="toggle-button-2" onclick="toggleLanguageList()">En &#9776;</button> 
                <ul class="language-list" id="languagelist">
                    <li>
                        <a href="Chinese.html" class="language-link" data-lang="chinese">中文</a>
                    </li>
                    <li>
                        <a href="French.html" class="language-link" data-lang="french">Français</a>
                    </li>
                    <li>
                        <a href="Spanish.html" class="language-link" data-lang="spanish">Español</a>
                    </li>
                    <li>
                        <a href="Japanese.html" class="language-link" data-lang="japanese">日本語</a>
                    </li>
                    <li>
                        <a href="Arabic.html" class="language-link" data-lang="arabian">عربي</a>
                    </li>
                    <li>
                        <a href="portuguese.html" class="language-link" data-lang="portuguese">Português</a>
                    </li>
                    <li>
                        <a href="Korean.html" class="language-link" data-lang="japanese">한국어</a>
                    </li>
                </ul>
            </div>
    </header> -->
              <!-- Modified Navigation HTML -->
               
<nav class="nav__bar_oi">
  <div class="nav__bar_oi-logo">
    <a href="index.html"><img src="assets/png_20221026_003820_0000.png" alt="HiTex EdiTex Logo"></a>
  </div>
  
  <button class="nav__bar_oi-toggle" id="navToggle">
    <span class="nav__bar_oi-toggle-line"></span>
    <span class="nav__bar_oi-toggle-line"></span>
    <span class="nav__bar_oi-toggle-line"></span>
  </button>
  
  <ul class="nav__bar_oi-menu" id="navMenu">
    <li class="nav__bar_oi-menu-item">
      <a href="about.html" class="nav__bar_oi-menu-link">About Us</a>
      <!-- <div class="nav__bar_oi-dropdown"> -->
        <!-- <a href="about.html" class="nav__bar_oi-dropdown-item">About Hitex EdiTex</a> -->
        <!-- <a href="leadership.html" class="nav__bar_oi-dropdown-item">Leadership</a> -->
        <!-- <a href="#offices" class="nav__bar_oi-dropdown-item">Offices</a> -->
        <!-- <a href="impact.html" class="nav__bar_oi-dropdown-item">Impact</a> -->
       
        
      </div>
    </li>
    <li class="nav__bar_oi-menu-item">
      <a href="#services" class="nav__bar_oi-menu-link">Services</a>
      <div class="nav__bar_oi-dropdown">
        <a href="language-editng.html" class="nav__bar_oi-dropdown-item">Language Editing</a>
        <a href="Scientific.html" class="nav__bar_oi-dropdown-item">Scientific Editing</a>
        <a href="technichal.html" class="nav__bar_oi-dropdown-item">Technical Editing</a>
        <a href="translate.html" class="nav__bar_oi-dropdown-item">Translation Services</a>
        <a href="service-levels.html" class="nav__bar_oi-dropdown-item">Service Levels</a>
        <a href="pricing.html" class="nav__bar_oi-dropdown-item">Pricing</a>
        <!-- <a href="auhtoredly.html" class="nav__bar_oi-dropdown-item">Authoredly</a> -->
      </div>
    </li>
    <li class="nav__bar_oi-menu-item">
      <a href="#careers" class="nav__bar_oi-menu-link">Careers</a>
      <div class="nav__bar_oi-dropdown">
        <a href="life-at-hitex.html" class="nav__bar_oi-dropdown-item">Life at HiTex EdiTex</a>
        <a href="In-house.html" class="nav__bar_oi-dropdown-item">In-house</a>
        <a href="freelance.html" class="nav__bar_oi-dropdown-item">Freelance</a>
      </div>
    </li>
    <li class="nav__bar_oi-menu-item">
      <a href="contact.html" class="nav__bar_oi-menu-link">Contact Us</a>
    </li>
    <li class="nav__bar_oi-menu-item">
      <a href="#resources" class="nav__bar_oi-menu-link">Helpful Resources</a>
      <div class="nav__bar_oi-dropdown">
        <a href="support" class="nav__bar_oi-dropdown-item">Support and FAQs</a>
        <a href="hitex-hub.html" class="nav__bar_oi-dropdown-item">The Hitex Hub</a>
        <!-- <a href="newsroom.html" class="nav__bar_oi-dropdown-item">Newsroom</a> -->
      </div>
    </li>
    <div class="nav__bar_oi-actions">
      <button class="nav__bar_oi-button nav__bar_oi-button-signup">Client Sign-Up</button>
      <button class="nav__bar_oi-button nav__bar_oi-button-login">Client Log-in</button>
    </div>
  </ul>
  
  <!-- Search bar and social media icons -->
  <div class="nav__bar_oi-utility">
    <div class="nav__bar_oi-search">
      <button class="nav__bar_oi-search-icon" id="searchToggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
      <div class="nav__bar_oi-search-container" id="searchContainer">
        <input type="text" class="nav__bar_oi-search-input" placeholder="Search..." aria-label="Search">
        <button class="nav__bar_oi-search-close" id="searchClose">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
    <div class="nav__bar_oi-social">
      <div class="new_loger_nav__bar_oi-actions">
        <a href="client-sign-up.html" class="new_loger_nav__bar_oi-button new_loger_nav__bar_oi-button-signup">Client Sign-up</a>
        <a href="client-login.html" class="new_loger_nav__bar_oi-button new_loger_nav__bar_oi-button-login">Client Log-in</a>
      </div>
   <div class="intbeh_01">
                        <div class="kli_002_wer">
                            <a href="https://www.threads.net/@hitexeditex">
                            <img src="assets/threads-icon.svg" class="alb-im-001">
                           </a>
                        </div>
                           </div>
                        <div class="kli_002_wer">
                    <a href="https://www.linkedin.com/company/hitexeditex/">
                    <img src="assets/linkedin-app-icon.svg" class="alb-im-001">
                   </a>
                   </div>
                   <div class="kli_002_wer">
                   <a href="https://x.com/HiTexEdiTex" target="_blank">
                    <img src="assets/x-social-media-black-icon.svg" alt="Twitter Icon" class="alb-im-001">
                  </a>
                  </div>  
                  <div class="kli_002_wer">
                   <a href="https://www.instagram.com/hitexeditex" target="_blank"  >
                    <img src="assets/ig-instagram-icon.svg" class="alb-im-001"></a>
                    </div>  
    </div>
  </div>
  <div class="nav__bar_oi-overlay" id="navOverlay"></div>
</nav>

 <style>
        :root {
            --blue: #032672;
            --light-blue: #D3E5FF;
            --button-background: linear-gradient(135deg, #eb2525, #af1e1e);
            --white: #ffffff;
            --text-color: #333;
            --grey-light: #f7f9fc;
            --grey: #e5e9f2;
            --text-light: #7e8c9a;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 10px;
        }
        
        .adm-fiu-dashboard-container { max-width: 1200px; margin: 6rem auto; background-color: var(--white); padding: 2rem; border-radius: var(--radius); box-shadow: var(--shadow); }
        h1 { color: var(--blue); border-bottom: 2px solid var(--light-blue); padding-bottom: 0.5rem;}
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; table-layout: fixed;}
        th, td { border: 1px solid var(--grey); padding: 12px; text-align: left; vertical-align: middle; word-wrap: break-word; }
        th { background-color: var(--light-blue); color: var(--blue); font-weight: bold; }
        .adm-fiu-download-btn { display: inline-block; padding: 6px 12px; background: var(--blue); color: white; text-decoration: none; border-radius: 4px; }
        .assign-btn { padding: 5px 10px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        select, .assign-btn { font-size: 0.9rem; padding: 4px; }
        .adm-fiu-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 100; }
        .adm-fiu-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--white); padding: 1.5rem; border-radius: var(--radius); z-index: 101; width: 90%; max-width: 600px; }
        .adm-fiu-modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--grey); padding-bottom: 1rem; margin-bottom: 1rem; }
        .adm-fiu-modal-header h2 { margin: 0; color: var(--blue);}
        .adm-fiu-modal-close { background: none; border: none; font-size: 2rem; cursor: pointer; }
        .adm-fiu-modal-body .form-row { display: flex; gap: 1rem; }
        .adm-fiu-modal-body .form-group { flex: 1; margin-bottom: 1rem; }
        .adm-fiu-modal-body label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        .adm-fiu-modal-body input, .adm-fiu-modal-body select { width: 100%; padding: 0.5rem; border-radius: 4px; border: 1px solid var(--grey); box-sizing: border-box; }
        .adm-fiu-submit-assignment { width: 100%; padding: 0.8rem; border: none; border-radius: var(--radius); background: var(--button-background); color: var(--white); font-size: 1.1rem; cursor: pointer; margin-top: 1rem; }
    </style>
<body>
    <div class="adm-fiu-dashboard-container">
        <h1>Submissions</h1>
        <table id="manuscriptTable">
            <thead>
                <tr>
                    <th style="width: 15%;">Submission Date</th>
                    <th style="width: 25%;">Original Filename</th>
                    <th style="width: 20%;">Status</th>
                    <th style="width: 10%;">Download</th>
                    <th style="width: 30%;">Assign to Editor</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <div class="adm-fiu-modal-overlay" id="assignmentModalOverlay" style="display: none;"></div>
    <div class="adm-fiu-modal" id="assignmentModal" style="display: none;">
        <div class="adm-fiu-modal-header">
            <h2>Assign Job Details</h2>
            <button class="adm-fiu-modal-close" id="closeModalBtn">&times;</button>
        </div>
        <div class="adm-fiu-modal-body">
            <form id="assignmentDetailsForm">
                <input type="hidden" id="modalManuscriptId">
                <input type="hidden" id="modalEditorId">
                <div class="form-row">
                    <div class="form-group"><label>Job Code:</label><input type="text" id="modalJobCode" placeholder="e.g., EDIT-001"></div>
                    <div class="form-group"><label>Job Type:</label><input type="text" id="modalJobType" value="Original"></div>
                </div>
                <div class="form-group">
                    <label>Service Type:</label>
                    <select id="modalServiceType">
                        <option value="proofreading">Proofreading</option>
                        <option value="copy-editing">Copy-editing</option>
                        <option value="substantive-editing">Substantive Editing</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Editable Words:</label><input type="number" id="modalEditableWords"></div>
                    <div class="form-group"><label>Effective Editable Words:</label><input type="number" id="modalEffectiveWords"></div>
                </div>
                <div class="form-group"><label>Target Journal:</label><input type="text" id="modalTargetJournal"></div>
                <div class="form-group"><label>English Language Requirements:</label><select id="modalLanguage"><option value="American English">American English</option><option value="British English">British English</option></select></div>
                <div class="form-group"><label>Subject Area:</label><input type="text" id="modalSubjectArea"></div>
                <div class="form-row">
                    <div class="form-group"><label>Begin by (Deadline):</label><input type="datetime-local" id="modalStartDate"></div>
                    <div class="form-group"><label>Return by (Deadline):</label><input type="datetime-local" id="modalReturnDate"></div>
                </div>
                <button type="submit" class="adm-fiu-submit-assignment">Finalize Assignment</button>
            </form>
        </div>
    </div>

    <script>
        function openAssignmentModal(manuscriptId, wordCount, serviceType) {
            const editorId = document.getElementById(`editor-select-${manuscriptId}`).value;
            if (!editorId) {
                alert('Please select an editor from the dropdown.');
                return;
            }
            document.getElementById('modalManuscriptId').value = manuscriptId;
            document.getElementById('modalEditorId').value = editorId;
            document.getElementById('modalEditableWords').value = wordCount;
            document.getElementById('modalEffectiveWords').value = wordCount;
            document.getElementById('modalServiceType').value = serviceType;
            document.getElementById('assignmentModal').style.display = 'block';
            document.getElementById('assignmentModalOverlay').style.display = 'block';
        }

        function closeAssignmentModal() {
            document.getElementById('assignmentModal').style.display = 'none';
            document.getElementById('assignmentModalOverlay').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('adminAuthToken');
            if (!token) {
                alert('Admin access required. Please log in.');
                window.location.href = '/admin-login.html';
                return;
            }

            document.getElementById('closeModalBtn').addEventListener('click', closeAssignmentModal);
            document.getElementById('assignmentModalOverlay').addEventListener('click', closeAssignmentModal);
            
            document.getElementById('assignmentDetailsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const manuscriptId = document.getElementById('modalManuscriptId').value;
                const assignmentData = {
                    editorId: document.getElementById('modalEditorId').value,
                    jobCode: document.getElementById('modalJobCode').value,
                    jobType: document.getElementById('modalJobType').value,
                    serviceType: document.getElementById('modalServiceType').value,
                    editableWords: document.getElementById('modalEditableWords').value,
                    effectiveEditableWords: document.getElementById('modalEffectiveWords').value,
                    targetJournal: document.getElementById('modalTargetJournal').value,
                    languageRequirements: document.getElementById('modalLanguage').value,
                    subjectArea: document.getElementById('modalSubjectArea').value,
                    assignmentStartDate: document.getElementById('modalStartDate').value,
                    assignmentReturnDate: document.getElementById('modalReturnDate').value
                };

                try {
                    const response = await fetch(`https://all-branched-end.onrender.com/admin/assign-job/${manuscriptId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                        body: JSON.stringify(assignmentData)
                    });
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.message || 'Failed to assign job');
                    alert('Job assigned successfully!');
                    window.location.reload();
                } catch (error) {
                    alert('Failed to assign job: ' + error.message);
                }
            });

            try {
                const editorResponse = await fetch('https://all-branched-end.onrender.com/admin/editors', { headers: { 'Authorization': `Bearer ${token}` } });
                if (!editorResponse.ok) throw new Error('Could not fetch editors.');
                const editors = await editorResponse.json();

                const manuscriptResponse = await fetch('https://all-branched-end.onrender.com/admin/dashboard', { headers: { 'Authorization': `Bearer ${token}` } });
                if (!manuscriptResponse.ok) throw new Error('Could not fetch manuscripts.');
                const manuscripts = await manuscriptResponse.json();

                const tableBody = document.querySelector('#manuscriptTable tbody');
                tableBody.innerHTML = ''; 
                
                manuscripts.forEach(doc => {
                    const row = tableBody.insertRow();
                    let statusInfo = doc.status || 'New';
                    if (doc.assignedEditorId) {
                        const assignedEditor = editors.find(e => e._id === doc.assignedEditorId);
                        statusInfo = `<span style="color: green; font-weight: bold;">Assigned</span> (to: ${assignedEditor ? assignedEditor.fullName : 'Unknown'})`;
                    }
                    let editorOptions = '<option value="">Select an Editor...</option>';
                    editors.forEach(editor => {
                        editorOptions += `<option value="${editor._id}">${editor.fullName}</option>`;
                    });
                    row.innerHTML = `
                        <td>${new Date(doc.uploadDate).toLocaleString()}</td>
                        <td>${doc.originalName}</td>
                        <td>${statusInfo}</td>
                        <td><a href="https://all-branched-end.onrender.com/${doc.filePath}" class="adm-fiu-download-btn" download>Download</a></td>
                        <td>
                            <div style="display: flex; gap: 5px;">
                               <select id="editor-select-${doc._id}" style="flex-grow: 1;">${editorOptions}</select>
                               <button onclick="openAssignmentModal('${doc._id}', '${doc.wordCount}', '${doc.serviceType}')" class="assign-btn">Assign</button>
                            </div>
                        </td>
                    `;
                });
            } catch (error) {
                alert('Error loading dashboard: ' + error.message);
            }
        });
    </script>
</body>
</html>